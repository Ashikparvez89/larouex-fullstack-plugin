# Railway Full-Stack Starter Example

This is the project structure generated by the `/scaffold-railway-full` command.

## Project Structure

```
my-railway-project/
├── src/
│   ├── app/
│   │   ├── layout.tsx              # Root layout with metadata
│   │   ├── page.tsx                # Home page component
│   │   ├── globals.css             # Global styles
│   │   └── api/
│   │       └── [...route]/         # API route handlers
│   │           └── route.ts
│   ├── components/
│   │   ├── ui/                     # Reusable UI components
│   │   ├── forms/                  # Form components
│   │   └── layout/                 # Layout components
│   ├── lib/
│   │   ├── utils.ts                # Utility functions
│   │   ├── api.ts                  # API client
│   │   └── db.ts                   # Database client
│   └── styles/
│       └── theme.css               # Theme variables
├── server/
│   ├── index.ts                    # Express server entry point
│   ├── routes/
│   │   ├── index.ts                # Route aggregator
│   │   ├── users.ts                # User routes
│   │   └── api.ts                  # API routes
│   ├── middleware/
│   │   ├── auth.ts                 # Authentication middleware
│   │   ├── cors.ts                 # CORS configuration
│   │   └── errorHandler.ts        # Error handling
│   ├── controllers/
│   │   └── userController.ts       # Business logic
│   ├── db/
│   │   ├── schema.prisma           # Prisma schema
│   │   ├── client.ts               # Prisma client instance
│   │   └── migrations/             # Database migrations
│   └── lib/
│       ├── validation.ts           # Input validation
│       └── logger.ts               # Logging utilities
├── prisma/
│   ├── schema.prisma               # Database schema (main)
│   └── seed.ts                     # Database seeding script
├── public/
│   ├── images/                     # Static images
│   │   ├── logo.svg
│   │   └── hero.jpg
│   └── favicon.ico
├── tests/
│   ├── unit/                       # Unit tests
│   ├── integration/                # Integration tests
│   └── e2e/                        # End-to-end tests
├── railway.toml                    # Railway configuration
├── Dockerfile                      # Container configuration
├── .dockerignore                   # Docker ignore patterns
├── next.config.ts                  # Next.js configuration
├── package.json                    # Dependencies
├── tsconfig.json                   # TypeScript configuration
├── .env.example                    # Environment variables template
└── README.md                       # Project documentation
```

## Key Files

### railway.toml

Railway configuration for environments, services, and builds:

```toml
[build]
builder = "NIXPACKS"
buildCommand = "npm run build"

[deploy]
startCommand = "npm start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[[services]]
name = "web"
[services.env]
NODE_ENV = "production"

[[services]]
name = "postgres"
[services.env]
POSTGRES_DB = "myapp"
POSTGRES_USER = "myapp"
```

### Dockerfile

Container configuration for Railway deployment:

```dockerfile
FROM node:18-alpine AS base

# Install dependencies only when needed
FROM base AS deps
WORKDIR /app
COPY package*.json ./
RUN npm ci

# Rebuild source code
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

# Generate Prisma Client
RUN npx prisma generate

# Build Next.js
RUN npm run build

# Production image
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

CMD ["node", "server.js"]
```

### server/

Express.js backend with PostgreSQL + Prisma:

- **RESTful API** with Express.js
- **PostgreSQL database** with Prisma ORM
- **Type-safe queries** with Prisma Client
- **Middleware** for auth, CORS, error handling
- **Controllers** for business logic separation

### prisma/schema.prisma

Database schema definition:

```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  posts     Post[]
}

model Post {
  id        String   @id @default(cuid())
  title     String
  content   String?
  published Boolean  @default(false)
  authorId  String
  author    User     @relation(fields: [authorId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

## Getting Started

### Prerequisites

- Node.js 18+ installed
- Railway account (free tier available)
- Railway CLI installed
- Git installed

### Railway CLI Installation

```bash
npm i -g @railway/cli
```

### Initial Setup

1. **Clone or create project:**
   ```bash
   git clone <repository-url>
   cd my-railway-project
   ```

2. **Login to Railway:**
   ```bash
   railway login
   ```

3. **Link to Railway project:**
   ```bash
   railway link
   ```
   Or create a new project:
   ```bash
   railway init
   ```

4. **Install dependencies:**
   ```bash
   npm install
   ```

5. **Set up environment variables:**
   ```bash
   cp .env.example .env.local
   ```

6. **Set up database:**
   ```bash
   # Add PostgreSQL service in Railway dashboard
   railway add postgresql

   # Pull database URL to local env
   railway variables

   # Run migrations
   npx prisma migrate dev

   # Seed database (optional)
   npx prisma db seed
   ```

7. **Run locally:**
   ```bash
   npm run dev
   ```
   - Frontend: http://localhost:3000
   - API: http://localhost:3000/api

### Using Railway CLI for Local Development

```bash
# Run with Railway environment variables
railway run npm run dev

# Open local app
railway open

# View logs
railway logs

# Check status
railway status
```

## Deployment

### Deploy to Railway

1. **First deployment:**
   ```bash
   # Commit your changes
   git add .
   git commit -m "Initial commit"

   # Deploy to Railway
   railway up
   ```

2. **Automatic deployments:**
   - Connect GitHub repository in Railway dashboard
   - Every push to main branch auto-deploys
   - Pull requests create preview environments

3. **Manual deployments:**
   ```bash
   railway up
   ```

4. **View deployment:**
   ```bash
   railway open
   ```

### Environment Variables

Set in Railway dashboard or via CLI:

```bash
# Set individual variables
railway variables set DATABASE_URL=postgresql://...
railway variables set JWT_SECRET=your_secret

# View all variables
railway variables

# Delete a variable
railway variables delete VAR_NAME
```

### Database Migrations

```bash
# Run migrations on Railway
railway run npx prisma migrate deploy

# Or connect and migrate
railway connect postgres
```

## Features Included

### Frontend (Next.js 15)

- **App Router** with server components and actions
- **TypeScript** for type safety
- **Tailwind CSS** for styling
- **Responsive design** mobile-first approach
- **SEO optimization** with metadata API
- **API routes** for serverless functions

### Backend (Express.js + Prisma)

- **Express.js** RESTful API server
- **Prisma ORM** type-safe database access
- **PostgreSQL** relational database
- **Middleware** authentication, CORS, error handling
- **Validation** input validation with Zod
- **Logging** structured logging with Pino

### Database (PostgreSQL + Prisma)

- **Prisma schema** declarative database modeling
- **Migrations** version-controlled schema changes
- **Seeding** populate database with initial data
- **Type safety** auto-generated TypeScript types
- **Query builder** intuitive API for database operations

### DevOps

- **Railway deployment** automatic deployments
- **Docker containerization** consistent environments
- **Health checks** endpoint monitoring
- **Environment management** separate dev/staging/prod
- **CI/CD** integrated with GitHub

## Next Steps

### Add More Pages

```bash
/add-page dashboard
/add-page profile
/add-page settings
```

### Create Components

```bash
/add-component UserCard --type functional
/add-component Sidebar --type layout
/add-component Button --type ui
```

### Add API Endpoints

```bash
/add-api-railway users --method GET
/add-api-railway users --method POST
/add-api-railway users/:id --method PUT
/add-api-railway users/:id --method DELETE
```

### Enhance Functionality

```bash
/add-auth                  # Add authentication
/add-database-railway      # Expand database schema
/add-websockets-railway    # Add real-time features
/add-file-upload           # Add file upload capability
/add-email                 # Add email notifications
```

### Deploy to Environments

```bash
/deploy-railway-staging      # Deploy to staging
/deploy-railway-production   # Deploy to production
```

## Common Tasks

### Adding a New Database Model

1. Edit `prisma/schema.prisma`:
   ```prisma
   model Product {
     id          String   @id @default(cuid())
     name        String
     description String?
     price       Decimal
     createdAt   DateTime @default(now())
   }
   ```

2. Create and run migration:
   ```bash
   npx prisma migrate dev --name add_product_model
   ```

3. Generate Prisma Client:
   ```bash
   npx prisma generate
   ```

4. Use in your code:
   ```typescript
   import { prisma } from '@/lib/db'

   const products = await prisma.product.findMany()
   ```

### Adding a New API Endpoint

1. Create controller in `server/controllers/productController.ts`:
   ```typescript
   export async function getProducts(req, res) {
     const products = await prisma.product.findMany()
     res.json(products)
   }
   ```

2. Create routes in `server/routes/products.ts`:
   ```typescript
   import express from 'express'
   import { getProducts } from '../controllers/productController'

   const router = express.Router()
   router.get('/products', getProducts)

   export default router
   ```

3. Register routes in `server/routes/index.ts`:
   ```typescript
   import productRoutes from './products'
   app.use('/api', productRoutes)
   ```

4. Test locally and deploy

### Adding Authentication

1. Run `/add-auth`
2. Update Prisma schema with User model
3. Run migrations
4. Implement auth middleware
5. Protect routes with middleware
6. Add login/logout endpoints
7. Test authentication flow

### Connecting to Database

```bash
# Open database client
railway connect postgres

# Or use Prisma Studio
npx prisma studio
```

### Viewing Logs

```bash
# View live logs
railway logs

# View logs for specific service
railway logs --service web

# Follow logs
railway logs --follow
```

## Configuration

### Environment Variables

Create `.env.local` for local development:

```bash
# Database
DATABASE_URL="postgresql://user:password@localhost:5432/mydb"

# Server
PORT=3000
NODE_ENV=development

# Authentication
JWT_SECRET=your_jwt_secret_key
JWT_EXPIRES_IN=7d

# API Keys
STRIPE_SECRET_KEY=sk_test_...
SENDGRID_API_KEY=SG...

# Next.js Public Variables
NEXT_PUBLIC_API_URL=http://localhost:3000/api
NEXT_PUBLIC_APP_NAME=My Railway App
```

In Railway, set these via dashboard or CLI.

### Custom Domain

1. Go to Railway dashboard > Settings > Domains
2. Add your domain (e.g., myapp.com)
3. Add DNS records:
   - CNAME record pointing to Railway URL
4. SSL certificate is automatically provisioned

### Scaling

Railway automatically scales based on usage:

- **Horizontal scaling:** Multiple instances
- **Vertical scaling:** More CPU/memory per instance
- Configure in Railway dashboard > Settings > Resources

## Monitoring and Debugging

### Railway Dashboard

Access via `railway open`:

- **Metrics:** CPU, memory, network usage
- **Logs:** Real-time and historical logs
- **Deployments:** Deployment history and status
- **Variables:** Environment variables management

### Application Monitoring

```bash
# View resource usage
railway status

# View build logs
railway logs --deployment

# View runtime logs
railway logs --service web
```

### Prisma Studio

Database GUI for development:

```bash
npx prisma studio
```

Opens at http://localhost:5555

### Local Debugging

1. **Frontend debugging:** Browser DevTools
2. **API debugging:** VS Code debugger with breakpoints
3. **Database queries:** Prisma query logging
4. **Network inspection:** Network tab in DevTools

## Performance Optimization

- **Database indexes:** Add indexes for frequently queried fields
- **Query optimization:** Use Prisma's `include` and `select` wisely
- **Caching:** Implement Redis for frequently accessed data
- **Connection pooling:** Configure Prisma connection pool
- **Static generation:** Use Next.js ISR for dynamic content
- **Image optimization:** Use `next/image` component
- **Code splitting:** Automatic with Next.js App Router

## Security Best Practices

- **Environment variables:** Use Railway secrets, never commit to Git
- **Input validation:** Validate all user input with Zod
- **SQL injection:** Prisma protects against SQL injection
- **Authentication:** Use JWT or session-based auth
- **HTTPS:** Enabled by default on Railway
- **Rate limiting:** Implement rate limiting middleware
- **CORS:** Configure CORS properly in Express

## Database Management

### Running Migrations

```bash
# Development (creates migration)
npx prisma migrate dev

# Production (applies migrations)
npx prisma migrate deploy

# Reset database (warning: deletes all data)
npx prisma migrate reset
```

### Seeding Database

Create `prisma/seed.ts`:

```typescript
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function main() {
  const user = await prisma.user.create({
    data: {
      email: 'test@example.com',
      name: 'Test User',
    },
  })
  console.log({ user })
}

main()
  .catch((e) => {
    console.error(e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
```

Run with:
```bash
npx prisma db seed
```

### Backup and Restore

```bash
# Backup
railway run pg_dump $DATABASE_URL > backup.sql

# Restore
railway run psql $DATABASE_URL < backup.sql
```

## Testing

### Unit Tests

```bash
npm run test
```

### Integration Tests

```bash
npm run test:integration
```

### E2E Tests

```bash
npm run test:e2e
```

## Resources

- [Railway Documentation](https://docs.railway.app/)
- [Next.js Documentation](https://nextjs.org/docs)
- [Prisma Documentation](https://www.prisma.io/docs)
- [Express.js Documentation](https://expressjs.com/)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)

## Troubleshooting

### Build Fails

- Check build logs: `railway logs --deployment`
- Verify all dependencies in `package.json`
- Ensure Prisma client is generated
- Check Node.js version in `package.json` engines field

### Database Connection Issues

- Verify `DATABASE_URL` is set correctly
- Check database service is running: `railway status`
- Test connection: `railway run npx prisma db pull`
- Ensure migrations are applied: `npx prisma migrate deploy`

### Application Won't Start

- Check start command in `package.json`
- Verify PORT environment variable
- Review runtime logs: `railway logs --service web`
- Check health check endpoint

### Environment Variables Not Available

- Set in Railway dashboard: Settings > Variables
- Or use CLI: `railway variables set KEY=VALUE`
- Restart service after adding variables
- For Next.js client-side, prefix with `NEXT_PUBLIC_`

## Migration from Other Platforms

### From Vercel

```bash
/migrate-vercel-to-railway
```

### From Azure

```bash
/migrate-azure-to-railway
```

### From Heroku

```bash
/migrate-heroku-to-railway
```

## Support

For issues or questions:
- Railway Discord: https://discord.gg/railway
- Railway Documentation: https://docs.railway.app
- GitHub Issues: [project-repository]/issues
- Community Forum: https://help.railway.app
