# Azure Full-Stack Starter Example

This is the project structure generated by the `/scaffold-azure-full` command.

## Project Structure

```
my-azure-project/
├── src/
│   ├── app/
│   │   ├── layout.tsx              # Root layout with metadata
│   │   ├── page.tsx                # Home page component
│   │   └── globals.css             # Global styles
│   ├── components/
│   │   ├── ui/                     # Reusable UI components
│   │   └── layout/                 # Layout components
│   ├── lib/
│   │   ├── utils.ts                # Utility functions
│   │   └── api.ts                  # API client helpers
│   └── styles/
│       └── theme.css               # Theme variables
├── api/
│   ├── app.js                      # Azure Functions entry point
│   ├── host.json                   # Functions runtime config
│   ├── package.json                # API dependencies
│   ├── lib/
│   │   ├── database.js             # Database connection
│   │   └── middleware.js           # API middleware
│   └── functions/
│       ├── GetItems/               # Example GET function
│       │   ├── index.js
│       │   └── function.json
│       └── PostItem/               # Example POST function
│           ├── index.js
│           └── function.json
├── public/
│   ├── images/                     # Static images
│   │   ├── logo.svg
│   │   └── hero.jpg
│   └── static_json/                # Static JSON data
│       └── content.json
├── .github/
│   └── workflows/
│       └── azure-static-web-apps.yml  # CI/CD pipeline
├── staticwebapp.config.json        # Static Web Apps configuration
├── next.config.ts                  # Next.js configuration
├── package.json                    # Frontend dependencies
├── tsconfig.json                   # TypeScript configuration
├── .env.local                      # Local environment variables
└── README.md                       # Project documentation
```

## Key Files

### staticwebapp.config.json

Static Web Apps configuration for routing, API integration, and security:

```json
{
  "navigationFallback": {
    "rewrite": "/index.html",
    "exclude": ["/images/*.{png,jpg,gif}", "/css/*"]
  },
  "routes": [
    {
      "route": "/api/*",
      "allowedRoles": ["authenticated"]
    }
  ],
  "responseOverrides": {
    "404": {
      "rewrite": "/404.html"
    }
  }
}
```

### .github/workflows/azure-static-web-apps.yml

GitHub Actions workflow for automated deployment:

```yaml
name: Azure Static Web Apps CI/CD

on:
  push:
    branches:
      - main
  pull_request:
    types: [opened, synchronize, reopened, closed]
    branches:
      - main

jobs:
  build_and_deploy_job:
    runs-on: ubuntu-latest
    name: Build and Deploy Job
    steps:
      - uses: actions/checkout@v3

      - name: Build And Deploy
        uses: Azure/static-web-apps-deploy@v1
        with:
          azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN }}
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          action: "upload"
          app_location: "/"
          api_location: "api"
          output_location: ".next"
```

### api/

Azure Functions backend with TypeScript support:

- **Serverless functions** triggered by HTTP requests
- **Auto-scaling** based on demand
- **Integrated authentication** with Azure Active Directory
- **Cosmos DB or SQL** database integration options

## Getting Started

### Prerequisites

- Node.js 18+ installed
- Azure account (free tier available)
- GitHub account
- Azure CLI installed (optional, for local development)

### Local Development

1. **Clone or create project:**
   ```bash
   git clone <repository-url>
   cd my-azure-project
   ```

2. **Install dependencies:**
   ```bash
   npm install
   cd api && npm install && cd ..
   ```

3. **Set up environment variables:**
   ```bash
   cp .env.example .env.local
   # Edit .env.local with your configuration
   ```

4. **Run locally:**
   ```bash
   npm run dev
   ```
   - Frontend: http://localhost:3000
   - API: http://localhost:7071/api

5. **Run Azure Functions locally:**
   ```bash
   cd api
   func start
   ```

### Deployment

#### First-Time Setup

1. **Create Azure Static Web App:**
   ```bash
   az staticwebapp create \
     --name my-azure-project \
     --resource-group my-resource-group \
     --location "West US 2"
   ```

2. **Connect to GitHub:**
   - Go to Azure Portal
   - Navigate to your Static Web App
   - Click "Manage deployment token"
   - Copy the token
   - Add as GitHub secret: `AZURE_STATIC_WEB_APPS_API_TOKEN`

3. **Push to GitHub:**
   ```bash
   git add .
   git commit -m "Initial commit"
   git push origin main
   ```

GitHub Actions will automatically build and deploy your app!

#### Subsequent Deployments

Simply push to the `main` branch:
```bash
git add .
git commit -m "Update feature"
git push origin main
```

## Features Included

### Frontend (Next.js 15)

- **App Router** with server components
- **TypeScript** for type safety
- **Tailwind CSS** for styling
- **Responsive design** out of the box
- **SEO optimization** with metadata API
- **Image optimization** with next/image

### Backend (Azure Functions)

- **Serverless APIs** with auto-scaling
- **TypeScript support** for type safety
- **CORS configuration** for frontend integration
- **Environment variables** for configuration
- **Logging** with Application Insights integration

### DevOps

- **GitHub Actions** CI/CD pipeline
- **Pull request previews** automatic preview environments
- **Environment variables** managed in Azure Portal
- **Custom domains** and SSL certificates

## Next Steps

### Add More Pages

```bash
/add-page about
/add-page contact
/add-page blog
```

### Create Components

```bash
/add-component Hero --type functional
/add-component Navbar --type layout
/add-component Card --type ui
```

### Add API Endpoints

```bash
/add-api-azure GetUsers --method GET
/add-api-azure CreateUser --method POST
/add-api-azure UpdateUser --method PUT
```

### Enhance Functionality

```bash
/add-auth              # Add authentication
/add-database-azure    # Add Cosmos DB or SQL
/add-form              # Add form with validation
/add-seo               # Enhance SEO
```

### Deploy to Environments

```bash
/deploy-azure-staging      # Deploy to staging
/deploy-azure-production   # Deploy to production
```

## Common Tasks

### Adding a New Page

1. Run `/add-page products`
2. Edit `src/app/products/page.tsx`
3. Add navigation link
4. Test locally
5. Push to deploy

### Adding a New API Function

1. Run `/add-api-azure GetProducts --method GET`
2. Implement business logic in `api/functions/GetProducts/index.js`
3. Test locally with `func start`
4. Call from frontend with `fetch('/api/GetProducts')`
5. Push to deploy

### Setting Up a Database

1. Run `/add-database-azure --type cosmosdb`
2. Configure connection string in Azure Portal
3. Update API functions to use database
4. Test locally with Azure Cosmos DB Emulator
5. Deploy to production

### Adding Authentication

1. Run `/add-auth`
2. Configure Azure AD in Azure Portal
3. Update `staticwebapp.config.json` with auth rules
4. Add login/logout buttons to UI
5. Protect API routes with role requirements

## Configuration

### Environment Variables

Create `.env.local` for local development:

```bash
# Azure Configuration
AZURE_STORAGE_CONNECTION_STRING=your_connection_string
COSMOS_DB_CONNECTION_STRING=your_cosmos_connection
AZURE_FUNCTION_KEY=your_function_key

# Next.js Configuration
NEXT_PUBLIC_API_URL=http://localhost:7071/api
NEXT_PUBLIC_APP_NAME=My Azure App
```

In Azure Portal, add these as Application Settings.

### Custom Domain

1. Go to Azure Portal > Static Web Apps > Custom domains
2. Add your domain (e.g., www.myapp.com)
3. Add DNS records as shown
4. SSL certificate is automatically provisioned

## Monitoring and Debugging

### Application Insights

View logs and metrics in Azure Portal:

- **Performance metrics:** Response times, throughput
- **Error tracking:** Exceptions and failed requests
- **Custom events:** Track user actions
- **Live metrics:** Real-time monitoring

### Local Debugging

1. **Frontend debugging:** Use browser DevTools
2. **API debugging:** Add breakpoints in VS Code
3. **Network inspection:** Check API calls in Network tab
4. **Console logging:** Use `console.log()` liberally during development

## Performance Optimization

- **Static generation:** Use `generateStaticParams` for dynamic routes
- **Image optimization:** Use `next/image` component
- **Code splitting:** Automatic with Next.js App Router
- **CDN caching:** Enabled by default on Azure Static Web Apps
- **Function cold starts:** Keep functions warm with scheduled pings

## Security Best Practices

- **Environment variables:** Never commit secrets to Git
- **API authentication:** Use Azure AD or custom auth
- **CORS configuration:** Restrict to your domain
- **Input validation:** Validate all user input
- **Rate limiting:** Implement in API functions

## Resources

- [Azure Static Web Apps Documentation](https://docs.microsoft.com/azure/static-web-apps/)
- [Next.js Documentation](https://nextjs.org/docs)
- [Azure Functions Documentation](https://docs.microsoft.com/azure/azure-functions/)
- [GitHub Actions Documentation](https://docs.github.com/actions)

## Troubleshooting

### Build Fails in GitHub Actions

- Check build logs in Actions tab
- Verify `package.json` scripts
- Ensure all dependencies are listed
- Check Node.js version compatibility

### API Functions Not Working

- Verify `api_location` in workflow file
- Check CORS settings
- Verify function bindings in `function.json`
- Check Application Insights for errors

### Environment Variables Not Available

- Add to Azure Portal > Configuration > Application settings
- For local dev, add to `.env.local`
- Prefix public variables with `NEXT_PUBLIC_`
- Restart development server after changes

## Support

For issues or questions:
- GitHub Issues: [project-repository]/issues
- Azure Support: https://azure.microsoft.com/support/
- Community: Stack Overflow with `azure-static-web-apps` tag
